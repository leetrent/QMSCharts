@{
    ViewData["Title"] = "Home Page";
}
<style>
    .k-footer-template {
        display: none;
    }

    .k-card-header {
        flex: 0 0 auto;
    }

    .k-card-body {
        overflow: hidden;
    }
</style>

<!-- container chart templates -->
<script id="downloads-chart-template" type="text/x-kendo-template">
    @(Html.Kendo().Chart()
                                        .Name("downloads")
                                        // to configure the chart theme to match the application theme use the theme setting
                                        // https://docs.telerik.com/kendo-ui/api/javascript/dataviz/ui/chart/configuration/theme
                                        //.Theme("sass")
                                        .Series(s => s.Line("Downloads", "Date"))
                                        .Legend(l => l.Visible(false))
                                        .CategoryAxis(c =>
                                            c.Date()
                                            .BaseUnit(ChartAxisBaseUnit.Fit)
                                            .Labels(l => l.Format("{0:d MMM}").Rotation("auto"))
                                            .MajorGridLines(mg => mg.Visible(false))
                                            .MajorTicks(mt => mt.Visible(false))
                                            )
                                        .ValueAxis(v => v.Min(2000).Max(16000).Labels(l => l.Step(4)))
                                        .DataSource("dateChartDataSource")
                                        .HtmlAttributes(new { style = "height:100%;width:100%;" })
                                        .ToClientTemplate()
    )
</script>
<script id="performance-chart-template" type="text/x-kendo-template">
    @(Html.Kendo().Chart()
                                        .Name("performance")
                                        // to configure the chart theme to match the application theme use the theme setting
                                        // https://docs.telerik.com/kendo-ui/api/javascript/dataviz/ui/chart/configuration/theme
                                        //.Theme("sass")
                                        .AutoBind(false)
                                        .Series(s => s.Column("Views", "Date"))
                                        .Legend(l => l.Visible(false))
                                        .CategoryAxis(c =>
                                            c.Date()
                                            .BaseUnit(ChartAxisBaseUnit.Fit)
                                            .Labels(l => l.Format("{0:d MMM}").Rotation("auto"))
                                            .MajorGridLines(mg => mg.Visible(false))
                                            .MajorTicks(mt => mt.Visible(false))
                                        )
                                        .ValueAxis(v => v.Min(4000).Max(30000).Labels(l => l.Step(3)))
                                        .DataSource("dateChartDataSource")
                                        .HtmlAttributes(new { style = "height:100%;width:100%;" })
                                        .ToClientTemplate()
    )
</script>

<div class="d-flex justify-content-center">
    @(Html.Kendo().DataSource<PodcastViewModel>()
                                        .Name("dateChartDataSource")
                                        .Custom(d =>
                                         d.Transport(t => t.Read("Downloads_Read", "Dashboard"))
                                        )
    )
    @(Html.Kendo().TileLayout()
                                            .Name("tilelayout")
                                            .Columns(4)
                                            .RowsHeight("145px")
                                            .ColumnsWidth("350px")
                                            .Containers(c =>
                                            {
                                                c.Add().Header(h => h.Text("Weekly Recap-Downloads")).BodyTemplateId("downloads-chart-template").ColSpan(2).RowSpan(3);
                                                c.Add().Header(h => h.Text("Performance Trend")).BodyTemplateId("performance-chart-template").ColSpan(2).RowSpan(3);
                                             })
                                            .Reorderable(true)
                                            .Resizable(true)
                                            .Events(e => e.Resize("onTileResize"))
    )
    <script>
        function onTileResize(e) {
            var container = e.item || e.container;
            if (container) {

                // for widgets that do not auto resize
                // https://docs.telerik.com/kendo-ui/styles-and-layout/using-kendo-in-responsive-web-pages
                kendo.resize(container, true);
            }
        }

        function populateTotals(e) {
            // we are using the aggregates of the grid to populate our totals
            var aggregates = e.sender.dataSource.aggregates();

            $("#total-streams").html(kendo.toString(aggregates.Streams.sum, "n0"));
            $("#total-downloads").html(kendo.toString(aggregates.Downloads.sum, "n0"));
            $("#total-reach").html(kendo.toString(aggregates.Reach.sum, "n0"));
            $("#total-revenue").html(kendo.toString(aggregates.Views.sum / 100, "c0"));
        }
    </script>
</div>
